{% extends "potrotransporte/tmpindex.html" %}
{% load static %}
{%block titulo%}
PotroTransporte
{%endblock%}

{%block cuerpo%}

<!--Inicio de CaruselAvisos -->

 {%if user.is_authenticated%}

<main class="container-fluid mb-3" role="main">



    <div class="row">

        <!--Inicio de Anuncio Tabla -->

        <div class="col-12 col-md-3">

            <div class="card ">
                <div class="card-header bg-warning text-center">Anuncios</div>
                <div class="card-body bg-dark">





        <div class="list-group anyClass">

          <a href="#" class="list-group-item list-group-item-action flex-column align-items-start active">
            <div class="d-flex w-100 justify-content-between">
              <h5 class="mb-1">List group item heading</h5>
              <small>3 days ago</small>
            </div>
            <p class="mb-1">Donec id elit non mi porta gravida at eget metus. Maecenas sed diam eget risus varius blandit.</p>
            <small>Donec id elit non mi porta.</small>
          </a>

          <a href="#" class="list-group-item list-group-item-action">
    <div class="d-flex w-100 justify-content-between">
      <h5 class="mb-1">List group item heading</h5>
      <small class="text-muted">3 days ago</small>
    </div>
    <p class="mb-1">Donec id elit non mi porta gravida at eget metus. Maecenas sed diam eget risus varius blandit.</p>
    <small class="text-muted">Donec id elit non mi porta.</small>
  </a>
            <a href="#" class="list-group-item list-group-item-action">
    <div class="d-flex w-100 justify-content-between">
      <h5 class="mb-1">List group item heading</h5>
      <small class="text-muted">3 days ago</small>
    </div>
    <p class="mb-1">Donec id elit non mi porta gravida at eget metus. Maecenas sed diam eget risus varius blandit.</p>
    <small class="text-muted">Donec id elit non mi porta.</small>
  </a>

        </div>





                </div>
            </div>
        </div>


        <!--Fin de Anuncio Tabla -->


        <!--Inicio de atajos de menu -->
        <div class="col mt-3">

            <div class="card bg-dark">
                <div class="card-body">

                    <!--Inicio de dialogos -->


                    <div class="row">

                        <div class="col">
                            <div class="card ">
                                <div class="card-header bg-warning text-center">Rutas</div>
                                <div class="card-body ">


                                    <div class="row">
                                    <div class="col-12">
                                        <!--ajustar mapa https://stackoverflow.com/questions/16885707/sizing-leaflet-map-inside-bootstrap-->
                                        <div class="container fill">
                                                   <div id="mapid">

                                                    </div>
                                    </div>

                                        </div>

                                        <div class="col-12">
                                    <a href="{%url 'crear_ruta'%}" type="submit" class="btn btn-primary btn-block m-3">Crear</a>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>


                    <div class="row mt-3">


                         <div class="col">
                            <div class="card">
                                <div class="card-header bg-warning text-center">Ruta en Vivo</div>
                                <div class="card-body">
                                  <button type="submit" class="btn btn-primary btn-block">Ver</button>
                                </div>
                            </div>


                        </div>

                        <div class="col">
                            <div class="card">
                                <div class="card-header bg-warning text-center">Cobro</div>
                                <div class="card-body">
                                      <button type="submit" class="btn btn-primary btn-block">Generar Cobro</button>
                                </div>
                            </div>


                        </div>

                         <div class="col mt-3">
                            <div class="card">
                                <div class="card-header bg-warning text-center">Crear Anuncio</div>
                                <div class="card-body">

                                    <form>

                                        <div class="form-group">
                                            <label for="exampleFormControlTextarea1">Anuncio:</label>
                                                    <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                                        </div>
                                          <button type="submit" class="btn btn-primary mb-2">Confirm identity</button>

                                    </form>

                                </div>
                            </div>


                        </div>

                    </div>


                    <!--Fin de dialogos -->


                </div>
            </div>
        </div>

        <!--Fin de atajos de menu -->



        </div>



</main>




<script>

  var greenIcon = L.icon({
    iconUrl: "{%static 'potrotransporte/potroParada.png'%}",
    iconSize:     [68, 45],// size of the icon
});

	var mymap = L.map('mapid').setView([19.298079, -98.95566], 15);

  	L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/streets-v11',
		tileSize: 512,
		zoomOffset: -1
	}).addTo(mymap);




 {%if rutas%}
    {%for rt in rutas%}

    L.marker([{{rt.Latitud}},{{rt.Longitud}}],{icon:greenIcon}).addTo(mymap)
	.bindPopup("<b>"+"{{rt.NombreRuta}}"+"</b><br />"+"{{rt.Horario}}" ).openPopup();

    {%endfor%}
    {%endif%}




mymap.on('click', function(ev) {
    mymap.removeLayer(estacion);
    document.getElementById("id_Longitud").value = ev.latlng.lng;
    document.getElementById("id_Latitud").value = ev.latlng.lat;
    var nombre = $('#id_NombreRuta').val();
    var horario = $('#id_Horario').val();
    var texto = "<b>¡"+nombre+"!</b><br />"+horario
    estacion = L.marker([ev.latlng.lat,ev.latlng.lng],{icon:greenIcon}).addTo(mymap).bindPopup(texto).openPopup();
//    alert(ev.latlng); // ev is an event object (MouseEvent in this case)
});



var mapmargin = 50;
$('#mymap').css("height", ($(window).height() - mapmargin));
$(window).on("resize", resize);
resize();
function resize(){

    if($(window).width()>=980){
        $('#mymap').css("height", ($(window).height() - mapmargin));
        $('#mymap').css("margin-top",50);
    }else{
        $('#mymap').css("height", ($(window).height() - (mapmargin+12)));
        $('#mymap').css("margin-top",-21);
    }

}


</script>


 {%else%}

    <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
        <!--Inicio de Indicadores -->

        <!--Fin de Indicadores -->

        <!--Inicio de Imagenes -->
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="{% static 'potrotransporte/anuncio.png' %}" class="d-block w-100" alt="" width="1100" height="600">
            </div>
        </div>
        <!--Fin de Imagenes -->

        <!--Inicio de COntroles de imagen -->

        <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>

        <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>

        <!--Fin de COntroles de imagen -->


    </div>

<!--Fin de CaruselAvisos -->


 {%endif%}



{%endblock%}


